<!DOCTYPE html>
<html lang="{{ app.request.locale }}">
<head>
    <meta charset="utf-8">
    <title>Hiber Bee</title>
    <meta name="description" content="IT Services & Consulting">
    <meta name="author" content="Hiberbee">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block stylesheets %}
        <link href="{{ asset('build/css/app.css') }}" rel="stylesheet"/>
    {% endblock %}
</head>
<body>
{% include 'header.html.twig' %}
<div>
    <script>
        function postAjax(url, data, success) {
            var params = typeof data == 'string' ? data : Object.keys(data).map(
                function (k) {
                    return encodeURIComponent(k) + '=' + encodeURIComponent(data[k])
                }
            ).join('&');

            var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
            xhr.open('POST', url);
            xhr.onreadystatechange = function () {
                if (xhr.readyState > 3 && xhr.status == 200) {
                    success(xhr.responseText);
                }
            };
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(params);
            return xhr;
        }

        function syncFacebookData() {
            FB.getLoginStatus(function (response) {
                if (response.status === 'connected') {
                    FB.api('/me', {fields: 'name,email,gender,locale,friends,picture'}, function (response) {
                        console.log(response);
                        postAjax('/sync-with-facebook', response, function () {
                        });
                    });
                }
            });
        }

        window.fbAsyncInit = function () {
            FB.init({
                appId: '145510372820525',
                cookie: true,
                xfbml: true,
                version: 'v2.11'
            });

            FB.getLoginStatus(function (response) {
                if (response.status === 'connected') {
                    document.getElementById('facebook_login').remove();
                }
            });
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.11&appId=145510372820525';
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

    </script>
    <div id="facebook_login">
        <fb:login-button scope="public_profile,email" onlogin="syncFacebookData();">
        </fb:login-button>
    </div>
</div>
<main role="main" class="container">
    {% block content %}{% endblock %}
</main>
{% include 'facebook-widget.html.twig' %}
{% include 'footer.html.twig' %}
{% block javascripts %}
    <script src="{{ asset('build/manifest.js') }}"></script>
    <script src="{{ asset('build/js/common.js') }}"></script>
    <script src="{{ asset('build/js/app.js') }}"></script>
{% endblock %}
</body>
</html>